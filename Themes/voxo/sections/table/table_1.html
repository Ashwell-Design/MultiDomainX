<div class="container-fluid">
	<table class="table">
		<thead>
		</thead>
		<tbody>
		</tbody>
	</table>

	<script>
		var [table, cols] = '<%[extension]%>'.split('-', 2);
		var tbody = (document.currentScript.parentNode).querySelector("tbody");
		var thead = (document.currentScript.parentNode).querySelector("tbody");

		initSqlJs({
			locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.1/${filename}`
		})
		.then(function(SQL){
			const xhr = new XMLHttpRequest();
			xhr.open('GET', '/central.sqlite', true);
			xhr.responseType = 'arraybuffer';
			xhr.onload = e => {
				const uInt8Array = new Uint8Array(xhr.response);
				const db = new SQL.Database(uInt8Array);

				var stmt = db.prepare("PRAGMA table_info("+table+")");
				stmt.getAsObject({$start:1, $end:1});
				stmt.bind({$start:1, $end:2});
				var th = thead.appendChild(document.createElement('tr'));
				var i=0;
				while(stmt.step()) {
					if(cols.includes(i)) {
						const row = stmt.getAsObject();
						tbl_row = th.appendChild(document.createElement('th'));
						tbl_row.textContent = Object.values(row)[1];
					}
					i++;
				}

				var stmt = db.prepare("SELECT * FROM " + table);
				stmt.getAsObject({$start:1, $end:1});
				stmt.bind({$start:1, $end:2});
				while(stmt.step()) {
					const row = stmt.getAsObject();
					var tr = tbody.appendChild(document.createElement('tr'));
					for (let s=0; s<cols.length; s++) {
						if(s == 0) {
							tbl_row = tr.appendChild(document.createElement('th'));
						} else {
							tbl_row = tr.appendChild(document.createElement('td'))
						}
						tbl_row.textContent = Object.values(row)[cols[s]];
					}
				}
			};
			xhr.send();
		});
	</script>
</div>